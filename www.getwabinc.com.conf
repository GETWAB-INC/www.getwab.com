<VirtualHost *:80>
    # Настройка основного домена www.getwabinc.com
    ServerName www.getwabinc.com
    ServerAlias getwabinc.com imap.getwabinc.com smtp.getwabinc.com

    ServerAdmin ioborin22@gmail.com
    DocumentRoot /var/www/html/www.getwabinc.com/public

    ErrorLog ${APACHE_LOG_DIR}/www.getwabinc.com.error.log
    CustomLog ${APACHE_LOG_DIR}/www.getwabinc.com.access.log combined

    <IfModule mod_headers.c>
        Header set Cache-Control "max-age=31536000"
    </IfModule>

    # Редирект с getwabinc.com на www.getwabinc.com
    RewriteEngine On
    RewriteCond %{HTTP_HOST} ^getwabinc\.com [NC]
    RewriteRule ^(.*)$ http://www.getwabinc.com$1 [L,R=301]
</VirtualHost>

<VirtualHost *:80>
    # Настройка для mail.getwabinc.com на HTTP
    ServerName mail.getwabinc.com

    ServerAdmin ioborin22@gmail.com
    DocumentRoot /var/www/html/www.getwabinc.com/mail

    ErrorLog ${APACHE_LOG_DIR}/mail.getwabinc.com.error.log
    CustomLog ${APACHE_LOG_DIR}/mail.getwabinc.com.access.log combined

    <IfModule mod_headers.c>
        Header set Cache-Control "max-age=31536000"
    </IfModule>
</VirtualHost>

<VirtualHost *:443>
    # Настройка для www.getwabinc.com и других поддоменов
    ServerName www.getwabinc.com
    ServerAlias getwabinc.com imap.getwabinc.com smtp.getwabinc.com

    ServerAdmin ioborin22@gmail.com
    DocumentRoot /var/www/html/www.getwabinc.com/public

    ErrorLog ${APACHE_LOG_DIR}/www.getwabinc.com.error.log
    CustomLog ${APACHE_LOG_DIR}/www.getwabinc.com.access.log combined

    SSLEngine on

    <IfModule mod_headers.c>
        Header set Cache-Control "max-age=31536000"
    </IfModule>

    # Редирект с getwabinc.com на www.getwabinc.com
    RewriteEngine On
    RewriteCond %{HTTP_HOST} ^getwabinc\.com [NC]
    RewriteRule ^(.*)$ https://www.getwabinc.com$1 [L,R=301]

    Include /etc/letsencrypt/options-ssl-apache.conf
    SSLCertificateFile /etc/letsencrypt/live/www.getwabinc.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/www.getwabinc.com/privkey.pem
</VirtualHost>

<VirtualHost *:443>
    # Настройка для mail.getwabinc.com на HTTPS
    ServerName mail.getwabinc.com

    ServerAdmin ioborin22@gmail.com
    DocumentRoot /var/www/html/www.getwabinc.com/mail

    ErrorLog ${APACHE_LOG_DIR}/mail.getwabinc.com.error.log
    CustomLog ${APACHE_LOG_DIR}/mail.getwabinc.com.access.log combined

    SSLEngine on

    <IfModule mod_headers.c>
        Header set Cache-Control "max-age=31536000"
    </IfModule>

    Include /etc/letsencrypt/options-ssl-apache.conf
    SSLCertificateFile /etc/letsencrypt/live/www.getwabinc.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/www.getwabinc.com/privkey.pem

    <Directory /var/www/html/www.getwabinc.com/mail>
        Options FollowSymLinks
        AllowOverride All

        # Добавляем аутентификацию
        AuthType Basic
        AuthName "Restricted Area"
        AuthUserFile /etc/apache2/.htpasswd2
        Require valid-user
    </Directory>

</VirtualHost>
